<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kids | Tudduke Okufa Ministry</title>

  <!-- FONTS -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <style>
    /* Custom Styles for Content Library */
    .content-library-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }

    .content-library-header h2 {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--k-text) 0%, var(--k-text-light) 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin: 0;
    }

    [data-theme="dark"] .content-library-header h2 {
      background: linear-gradient(135deg, #fff 0%, #cbd5e1 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .content-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 20px;
    }

    /* Glassmorphism & Premium Textures */
    .content-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 24px;
      padding: 28px;
      transition: all 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow:
        0 4px 6px rgba(0, 0, 0, 0.02),
        0 12px 24px rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: 100%;
    }

    [data-theme="dark"] .content-card {
      background: rgba(30, 30, 35, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.08);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
    }

    .content-card:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow:
        0 20px 40px rgba(0, 0, 0, 0.1),
        0 8px 16px rgba(0, 0, 0, 0.05);
      border-color: rgba(255, 255, 255, 0.9);
      background: rgba(255, 255, 255, 0.95);
    }

    [data-theme="dark"] .content-card:hover {
      background: rgba(40, 40, 45, 0.9);
      border-color: rgba(255, 255, 255, 0.15);
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
    }

    /* Beautiful Empty State */
    .empty-state {
      background: rgba(255, 255, 255, 0.5);
      border: 2px dashed rgba(0, 0, 0, 0.1);
      border-radius: 24px;
      padding: 50px 20px;
      text-align: center;
      grid-column: 1 / -1;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
      transition: 0.3s;
    }

    [data-theme="dark"] .empty-state {
      background: rgba(255, 255, 255, 0.03);
      border-color: rgba(255, 255, 255, 0.1);
    }

    .empty-state:hover {
      background: rgba(255, 255, 255, 0.8);
      border-color: var(--k-brand);
      transform: scale(1.02);
    }

    [data-theme="dark"] .empty-state:hover {
      background: rgba(255, 255, 255, 0.06);
    }

    .btn-view {
      width: 100%;
      padding: 14px;
      border-radius: 16px;
      background: var(--k-surface);
      color: var(--k-text);
      font-weight: 700;
      letter-spacing: 0.5px;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .btn-view:hover {
      background: var(--k-brand);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 20px rgba(220, 38, 38, 0.25);
    }

    [data-theme="dark"] .btn-view {
      background: rgba(255, 255, 255, 0.1);
    }

    /* Layout Balance: Side-by-Side on Desktop */
    .split-section {
      display: grid;
      grid-template-columns: 1fr;
      gap: 40px;
      padding: 0 20px 80px;
      max-width: 1200px;
      margin: 0 auto;
    }

    @media (min-width: 900px) {
      .split-section {
        grid-template-columns: 1fr 1fr;
        gap: 60px;
        align-items: start;
        /* Prevent stretching if one column is short */
      }
    }

    /* Large Screen Optimization (1920x1080) */
    @media (min-width: 1400px) {

      .split-section,
      .content-library,
      .cards {
        max-width: 1600px !important;
      }

      .content-grid {
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)) !important;
        gap: 30px;
      }
    }
  </style>
</head>

<body>

  <header>
    <div class="header-left">
      <button class="menu-toggle" id="menuToggle">
        <i data-feather="menu"></i>
      </button>
      <div class="header-text">
        <h1>TUDDUKE OKUFA</h1>
        <p>Preparing People for the Second Coming</p>
      </div>
    </div>
    <button class="theme-toggle" id="themeToggle" title="Toggle Theme">
      <i data-feather="moon"></i>
    </button>
  </header>

  <aside id="sidebar">
    <a href="index.html" class="active"><i data-feather="home"></i> Kids Home</a>
    <a href="videos.html"><i data-feather="play-circle"></i> Kids Videos</a>
    <a href="quiz.html"><i data-feather="help-circle"></i> Bible Quiz</a>
    <a href="memory-verses.html"><i data-feather="book-open"></i> Memory Verses</a>
    <a href="children-sermon.html"><i data-feather="mic"></i> Children Sermons</a>
    <a href="weekly-lesson.html"><i data-feather="sun"></i> Weekly Lessons</a>
    <a href="parents.html"><i data-feather="users"></i> Parents & Teachers</a>
    <div style="height: 1px; background: rgba(0,0,0,0.1); margin: 10px 0;"></div>
    <a href="auth.html" style="color: var(--k-brand); border: 1px solid var(--k-brand); justify-content: center;"><i
        data-feather="lock"></i> Login / Join</a>
    <a href="../index.html" style="opacity: 0.7;"><i data-feather="arrow-left"></i> Home Page</a>
  </aside>

  <div class="overlay" id="overlay"></div>

  <section class="hero">
    <div class="hero-content">
      <span class="hero-badge">Welcome Kids!</span>
      <h2>Grow in Faith, Love & Obedience</h2>
      <p>Explore Bible stories, fun quizzes, and lessons specially made for you.</p>
    </div>
  </section>

  <section class="cards">

    <a href="videos.html" class="card-link">
      <div class="card">
        <h3>Kids Videos</h3>
        <p>Bible stories and Christian teachings made simple.</p>
      </div>
    </a>

    <a href="quiz.html" class="card-link">
      <div class="card">
        <h3>Bible Quiz</h3>
        <p>Fun questions to help you learn the Bible.</p>
      </div>
    </a>

    <a href="memory-verses.html" class="card-link">
      <div class="card">
        <h3>Memory Verses</h3>
        <p>Easy verses to memorize daily.</p>
      </div>
    </a>

    <a href="children-sermon.html" class="card-link">
      <div class="card">
        <h3>Children Sermons</h3>
        <p>Short sermons specially prepared for you.</p>
      </div>
    </a>

    <a href="weekly-lesson.html" class="card-link">
      <div class="card">
        <h3>Weekly Lessons</h3>
        <p>This week's special Bible study.</p>
      </div>
    </a>

  </section>

  <div class="split-section">
    <!-- TEACHER RESOURCES SECTION -->
    <section class="content-library" style="padding: 0; margin: 0;">
      <div class="content-library-header">
        <h2>Teacher Resources</h2>
      </div>
      <div class="content-grid" id="resourcesBody" style="grid-template-columns: 1fr;">
        <div style="text-align: center; color: var(--k-text-light);">
          <i data-feather="loader" style="animation: spin 2s linear infinite;"></i> Loading resources...
        </div>
      </div>
    </section>

    <!-- UPCOMING EVENTS SECTION -->
    <section class="content-library" style="padding: 0; margin: 0;">
      <div class="content-library-header">
        <h2>Upcoming Events</h2>
      </div>
      <div class="content-grid" id="eventsBody" style="grid-template-columns: 1fr;">
        <div style="text-align: center; color: var(--k-text-light);">
          <i data-feather="loader" style="animation: spin 2s linear infinite;"></i> Loading events...
        </div>
      </div>
    </section>
  </div>

  <!-- FOOTER -->
  <footer class="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <h3>Tudduke Okufa Ministry</h3>
        <p class="leader-text">Led by Servant Kiviri John Mark</p>
      </div>

      <div class="footer-dev">
        <p>Developed with excellence by</p>
        <a href="#" class="dev-link">InnoTech Solutions</a>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; <span id="year"></span> Tudduke Okufa. All Rights Reserved.</p>
    </div>
  </footer>

  <script src="auth-helper.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="script.js"></script>
  <script>
    /* Check Login State (Profile Display) */
    const userStr = localStorage.getItem('kidsUser');
    const token = localStorage.getItem('kidsToken');

    if (userStr) {
      try {
        const user = JSON.parse(userStr);
        const badge = document.querySelector('.hero-badge');
        if (badge) badge.textContent = `Welcome, ${user.firstName}!`;
      } catch (e) { }
    }

    /* FETCH VERIFIED CONTENT */
    async function loadVerifiedContent() {
      const resourcesGrid = document.getElementById('resourcesBody');
      const eventsGrid = document.getElementById('eventsBody');

      const getApiBase = () => {
        const { hostname, protocol, port } = window.location;
        if (protocol === 'file:') return 'http://localhost:3000';
        if ((hostname === 'localhost' || hostname === '127.0.0.1') && port !== '3000') {
          return 'http://localhost:3000';
        }
        return '';
      };
      const API_BASE = getApiBase();

      try {
        const headers = token ? { 'Authorization': `Bearer ${token}` } : {};

        // Fetch Resources and Schedule (Events)
        const [resRes, resEvt] = await Promise.all([
          fetch(`${API_BASE}/api/kids/resources`, { headers }),
          fetch(`${API_BASE}/api/kids/schedule`, { headers })
        ]);

        const resourcesData = resRes.ok ? await resRes.json() : [];
        const eventsData = resEvt.ok ? await resEvt.json() : [];

        // RENDER RESOURCES
        if (resourcesData.length === 0) {
          resourcesGrid.innerHTML = `
            <div class="empty-state">
              <div style="background: var(--k-surface); padding: 20px; border-radius: 50%;">
                <i data-feather="inbox" style="width: 32px; height: 32px; color: var(--k-text-light);"></i>
              </div>
              <h3 style="color: var(--k-text); font-size:1.1rem; margin:0;">No Resources Yet</h3>
              <p style="color: var(--k-text-light); font-size: 0.9rem; margin:0;">Teachers haven't shared anything new today.</p>
            </div>`;
        } else {
          resourcesGrid.innerHTML = resourcesData.map(item => {
            const date = new Date(item.createdAt);
            const isNew = (new Date() - date) < (7 * 24 * 60 * 60 * 1000);
            return `
            <div class="content-card">
              ${isNew ? '<div class="card-badge-new">New</div>' : ''}
              <div class="card-icon-wrapper" style="background: #e0f2fe; color: #0284c7;">
                <i data-feather="file-text"></i>
              </div>
              <div class="card-meta">
                <span><i data-feather="clock" style="width:12px;"></i> ${date.toLocaleDateString()}</span>
                <span style="opacity:0.5;">•</span>
                <span>Resource</span>
              </div>
              <h3>${item.title}</h3>
              <div class="card-action">
                <a href="${item.fileUrl}" target="_blank" class="btn-view">Download <i data-feather="download" style="width:16px;"></i></a>
              </div>
            </div>`;
          }).join('');
        }

        // RENDER EVENTS
        if (eventsData.length === 0) {
          eventsGrid.innerHTML = `
            <div class="empty-state">
              <div style="background: var(--k-surface); padding: 20px; border-radius: 50%;">
                <i data-feather="calendar" style="width: 32px; height: 32px; color: var(--k-text-light);"></i>
              </div>
              <h3 style="color: var(--k-text); font-size:1.1rem; margin:0;">No Upcoming Events</h3>
              <p style="color: var(--k-text-light); font-size: 0.9rem; margin:0;">Check back later for fun activities!</p>
            </div>`;
        } else {
          eventsGrid.innerHTML = eventsData.map(item => {
            const date = new Date(item.eventDate);
            // Format: "Sat, Jan 25 @ 10:00 AM"
            const dateStr = date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            const timeStr = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

            return `
            <div class="content-card">
              <div class="card-icon-wrapper" style="background: #f3e8ff; color: #7c3aed;">
                <i data-feather="calendar"></i>
              </div>
              <div class="card-meta">
                <span><i data-feather="clock" style="width:12px;"></i> ${dateStr}</span>
                <span style="opacity:0.5;">•</span>
                <span>${timeStr}</span>
              </div>
              <h3>${item.title}</h3>
              <p style="font-size:0.95rem; color:var(--k-text-light); margin:0; line-height:1.5;">${item.description || ''}</p>
            </div>`;
          }).join('');
        }

        feather.replace();

      } catch (err) {
        console.error(err);
        const errorHTML = `
            <div style="grid-column: 1 / -1; text-align: center; color: #ef4444;">
                <i data-feather="alert-circle"></i> <p>Unable to load content.</p>
            </div>`;
        resourcesGrid.innerHTML = errorHTML;
        eventsGrid.innerHTML = errorHTML;
        feather.replace();
      }
    }

    loadVerifiedContent();
  </script>

</body>

</html>